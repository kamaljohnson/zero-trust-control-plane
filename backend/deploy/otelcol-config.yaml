# OpenTelemetry Collector config for ZTCP: receive OTLP from the gRPC server,
# export traces to Tempo, metrics to Prometheus, and logs to Loki.
# Use with the contrib distribution: otelcol-contrib (includes loki exporter).
#
# Example: otelcol-contrib --config deploy/otelcol-config.yaml
#
# Backends: run Loki (e.g. 3100), Prometheus (e.g. 9090), Tempo (e.g. 4317).
# Set OTEL_EXPORTER_OTLP_ENDPOINT to the collector's gRPC address (e.g. localhost:4317).

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  batch:
    send_batch_size: 1024
    timeout: 10s

exporters:
  # Traces -> Tempo (OTLP gRPC). Use tempo:4317 when Tempo runs in another container.
  otlp/tempo:
    endpoint: tempo:4317
    tls:
      insecure: true

  # Metrics -> Prometheus scrape endpoint. Collector exposes /metrics for Prometheus to scrape.
  prometheus:
    endpoint: "0.0.0.0:8889"
    namespace: ztcp

  # Logs -> Loki. Requires otelcol-contrib (loki exporter).
  loki:
    endpoint: http://localhost:3100/loki/api/v1/push
    default_labels_enabled:
      exporter: true
      job: true

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp/tempo]
    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [prometheus]
    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [loki]
