# Production environment template for ZTCP deployment
# Copy this file to .env.prod and configure all values before deployment
#
# IMPORTANT: Never commit .env.prod to version control!
# Generate JWT keys using: ./scripts/generate-jwt-keys.sh

# --- Backend Configuration ---

# gRPC listen address (default :8080)
GRPC_ADDR=:8080

# PostgreSQL connection string
# MUST use the same USER and PASSWORD as POSTGRES_USER and POSTGRES_PASSWORD below (postgres container uses these).
# Production uses SSL: run ./scripts/generate-postgres-ssl.sh to create deploy/postgres-ssl/ (server.crt, server.key).
# Format: postgres://USER:PASSWORD@postgres:5432/ztcp?sslmode=require
DATABASE_URL=postgres://ztcp:CHANGE_ME_SECURE_PASSWORD@postgres:5432/ztcp?sslmode=require

# JWT Authentication Keys
# Generate using: ./scripts/generate-jwt-keys.sh
# These should be RSA or ECDSA keys in PEM format.
# Use file paths (e.g. keys/jwt_private.pem) with keys in deploy/keys/; the backend container mounts deploy/keys as /app/keys.
# Or use inline PEM (escape any $ in the key as $$ to avoid Compose substitution).
JWT_PRIVATE_KEY=
# Public key: path or inline PEM
JWT_PUBLIC_KEY=
JWT_ISSUER=ztcp-auth
JWT_AUDIENCE=ztcp-api
JWT_ACCESS_TTL=15m
JWT_REFRESH_TTL=168h

# Password hashing
BCRYPT_COST=12

# --- SMS Configuration (for MFA OTP) ---
# Configure if using SMS-based MFA
SMS_LOCAL_API_KEY=
SMS_LOCAL_SENDER=
SMS_LOCAL_BASE_URL=https://app.smslocal.in/api/smsapi

# --- Device Trust Configuration ---
DEFAULT_TRUST_TTL_DAYS=30

# --- Application Environment ---
# MUST be set to "production" in production deployments
APP_ENV=production
# MUST be false in production
OTP_RETURN_TO_CLIENT=false

# --- OpenTelemetry Configuration ---
# OTLP endpoint for telemetry export (internal Docker network)
OTEL_EXPORTER_OTLP_ENDPOINT=http://otelcol:4317
OTEL_SERVICE_NAME=ztcp-grpc
OTEL_EXPORTER_OTLP_INSECURE=false

# --- Frontend Configuration ---
# Backend gRPC URL (internal Docker network)
BACKEND_GRPC_URL=backend:8080

# Optional: Default organization ID for login form (single-tenant)
# NEXT_PUBLIC_DEFAULT_ORG_ID=

# Dev OTP: when true, OTP is returned to client (no SMS). Set true for PoC even in production if desired.
NEXT_PUBLIC_DEV_OTP_ENABLED=false

# Docs site URL: where the "Docs" link in the app header points. Docs run on the droplet at /docs.
# Set to https://<DOMAIN>/docs (e.g. https://yourdomain.com/docs) so the frontend links to the same host.
NEXT_PUBLIC_DOCS_URL=https://yourdomain.com/docs

# Grafana: base URL for the app dashboard "Open Grafana" link. Served at https://<DOMAIN>/grafana when nginx and Grafana subpath are configured.
NEXT_PUBLIC_GRAFANA_URL=https://yourdomain.com/grafana
# Grafana subpath (required for /grafana behind nginx). Set ROOT_URL to the same base as NEXT_PUBLIC_GRAFANA_URL.
GF_SERVER_SERVE_FROM_SUB_PATH=true
GF_SERVER_ROOT_URL=https://yourdomain.com/grafana

# --- PostgreSQL Configuration (for postgres service) ---
# These are used by docker-compose when starting the postgres container (postgres.yml).
# DATABASE_URL above MUST use the same POSTGRES_USER and POSTGRES_PASSWORD (same literal values).
POSTGRES_USER=ztcp
POSTGRES_PASSWORD=CHANGE_ME_SECURE_PASSWORD
POSTGRES_DB=ztcp

# --- Grafana Configuration ---
# Used by the Grafana container (observability.yml). Set a strong admin password in production.
GF_SECURITY_ADMIN_PASSWORD=CHANGE_ME_SECURE_PASSWORD
# Disable anonymous access in production
GF_AUTH_ANONYMOUS_ENABLED=false
GF_AUTH_DISABLE_LOGIN_FORM=false

# --- Domain Configuration ---
# Your domain name (used for SSL certificate generation)
DOMAIN=yourdomain.com
