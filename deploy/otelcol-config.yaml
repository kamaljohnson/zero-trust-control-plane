# OpenTelemetry Collector config for ZTCP: receive OTLP from the gRPC server,
# export traces to Tempo, metrics to Prometheus, and logs to Loki.
# Use with the contrib distribution: otelcol-contrib (includes loki exporter).
#
# Docker Compose: use as-is (service names loki, tempo). Mount this file as the collector config.
# Host/standalone: copy this file and set Loki endpoint to http://localhost:3100/loki/api/v1/push
# and Tempo endpoint to localhost:4317 so the collector can reach backends on the same machine.
#
# Set OTEL_EXPORTER_OTLP_ENDPOINT to the collector's gRPC address (e.g. localhost:4317).

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  batch:
    send_batch_size: 1024
    timeout: 10s

exporters:
  # Traces -> Tempo (OTLP gRPC). Use tempo:4317 in Compose; localhost:4317 when running on host.
  otlp/tempo:
    endpoint: tempo:4317
    tls:
      insecure: true

  # Metrics -> Prometheus scrape endpoint. Collector exposes /metrics for Prometheus to scrape.
  prometheus:
    endpoint: "0.0.0.0:8889"
    namespace: ztcp

  # Logs -> Loki. Use loki:3100 in Compose; localhost:3100 when running on host.
  loki:
    endpoint: http://loki:3100/loki/api/v1/push
    default_labels_enabled:
      exporter: true
      job: true

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp/tempo]
    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [prometheus]
    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [loki]
